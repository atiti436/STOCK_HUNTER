# 🚨 V7/V8/V9 版本不一致問題 - 交接文件

> **建立日期**：2026-01-23 03:38
> **對象**：下一個接手的 AI（Claude Code 或 Gemini）
> **狀態**：🔴 待修復

---

## 🌳 背景：這個專案是什麼？

這是一個**台股選股 Bot**，用來幫用戶（Jacky）每天篩選值得關注的股票。

### 專案結構簡介
- `scan_20260106.py`：主掃描程式，每天收盤後執行，產生 `candidates.json`
- `scan_all_versions.py`：版本比較工具，讀取 `candidates.json` 套用不同版本篩選邏輯
- 版本從 V4 → V5 → V6 → V7 → V9 逐步演進

### 版本演進歷史
| 版本 | 理念 | 適合誰 |
|------|------|--------|
| **V4** | 穩健（YoY > 0 硬門檻）| 波段操作 |
| **V5** | 寬鬆（加分制）| 當沖/隔日沖 |
| **V6** | 嚴格（5日 < 5%）| 只要起漲點 |
| **V7** | 🔴 **有歧義** | 見下文 |
| **V9** | V7 + KD 金叉確認 | 右側交易 |

---

## 📖 故事：為什麼會搞混？

### 第一次定義 V7（1/20 前）
用戶參考「Daily Dip」策略，定義 V7 = **回檔狙擊**：
- 今日跌 -4%~0%
- 靠近 MA10/MA20 支撐
- 均線多頭 MA10 > MA20

**實績**：1/16、1/20 各選出 3 檔，其中聯茂連續出現後起漲 ✅

### 第二次定義 V7（1/22 晚上）
用戶用 Claude Code 想改成「量縮蓄勢」策略：
- 連續 3 天 Close > MA20
- 連續 3 天 Volume < MA20 * 0.8

**但問題是**：
1. Claude Code 把這個新邏輯寫進 `scan_20260106.py` 叫 V7
2. 舊的 `scan_all_versions.py` 還是用 Daily Dip 叫 V7
3. 沒有統一命名

### 今晚（1/23 凌晨）
用 Gemini 討論後發現：
- 「量縮蓄勢」無法選到聯茂（量沒有連續縮 3 天）
- 舊的「Daily Dip」反而是驗證有效的
- 兩邊 V7 定義不同造成混亂

---

## 問題摘要

**兩個程式對 V7 的定義不一致**，導致：
1. 文件說一套
2. `scan_20260106.py` 做另一套
3. `scan_all_versions.py` 又是另一套

---

## 版本定義衝突對照表

| 版本 | 文件定義 | scan_20260106.py | scan_all_versions.py |
|------|---------|-----------------|---------------------|
| **V7** | Daily Dip（回檔狙擊）| ❌ **量縮蓄勢** | ✅ Daily Dip |
| **V8** | 量縮蓄勢 | ❌ 沒有 V8 | ❌ 沒有 V8 |
| **V9** | V7 + KD 確認 | ✅ V7 + KD | ✅ V7 + KD |

---

## 程式碼位置

### scan_20260106.py 的 V7（第 1264-1291 行）
```python
# V7 篩選：連續 3 天 Close > MA20 AND 連續 3 天 Volume < MA(Volume,20) * 0.8
trend_ok = all(closes[i] > ma20_price for i in range(3))
squeeze_ok = all(volumes[i] < ma20_volume * 0.8 for i in range(3))
```
**這是「量縮蓄勢」策略**，未經驗證

### scan_all_versions.py 的 V7（第 220-228 行）
```python
# V7: 狙擊手版 (Daily Dip)
# 今日跌 -4%~0%, 法人5日>500, RSI<70, 5日 -5%~5%
# 均線多頭 MA10>MA20, 接近支撐 (乖離<2%)
```
**這是「Daily Dip」策略**，已驗證有效（1/16、1/20 各3檔）

---

## 實測結果

### Daily Dip（scan_all_versions.py 的 V7）
- ✅ 1/16 選出 3 檔
- ✅ 1/20 選出 3 檔（包含聯茂）
- ✅ 聯茂連續出現後起漲

### 量縮蓄勢（scan_20260106.py 的 V7）
- ❌ 聯茂無法被選到（量沒有連續縮 3 天）
- ❓ 未經實戰驗證

---

## 建議修復方案

### 方案 A：統一成 Daily Dip（推薦）
1. 把 `scan_20260106.py` 的 V7「量縮蓄勢」改名為 **V8**
2. 在 `scan_20260106.py` 新增 **V7 Daily Dip** 邏輯
3. 保持 V9 = V7 + KD

### 方案 B：統一成量縮蓄勢
1. 把 `scan_all_versions.py` 的 V7 改成「量縮蓄勢」
2. Daily Dip 改名為 V7 Lite 或廢棄

### 方案 C：分開命名
1. `scan_20260106.py`：V7=量縮蓄勢, V9=V7+KD
2. `scan_all_versions.py`：V7=Daily Dip, V9=V7+KD
3. 接受兩個程式的 V7 定義不同

---

## 相關檔案

| 檔案 | 用途 |
|------|------|
| `scan_20260106.py` | 主掃描程式（含 V7 量縮蓄勢） |
| `scan_all_versions.py` | 版本比較（含 V7 Daily Dip） |
| `V9_IMPLEMENTATION_CONTEXT.md` | 版本定義文件（已更新） |
| `BOT_VERSION_HISTORY.md` | 版本歷史（已更新） |

---

## 用戶決定

**用戶尚未決定要用哪個方案**，請在下次對話時詢問用戶想怎麼處理。
