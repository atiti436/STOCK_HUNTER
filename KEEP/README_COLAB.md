# Manpan 情報網 v4.1 - Google Colab 使用指南

## 📊 專案概述

**Manpan 情報網 v4.1** 是一個機構等級的股票分析系統，透過六大守護者邏輯層層過濾，找出高勝率標的並管理風險。

### 當前版本：MVP（最小可行產品）
- ✅ 純 Python 標準庫（無需安裝套件）
- ✅ Mock Data 模擬（不串接真實 API）
- ✅ 完整六大守護者邏輯
- ✅ 可在 Google Colab 直接執行

---

## 🚀 快速開始（Google Colab）

### 方法 1：直接上傳檔案

1. 開啟 [Google Colab](https://colab.research.google.com/)
2. 點擊「檔案」→「上傳筆記本」
3. 新增程式碼儲存格，貼上以下內容：

```python
# 如果檔案在本地，先上傳
from google.colab import files
uploaded = files.upload()  # 上傳 manpan_v4_1.py

# 執行腳本
!python manpan_v4_1.py
```

### 方法 2：從 GitHub 載入（未來）

```python
# Clone Repository
!git clone https://github.com/你的帳號/stock-hunter.git
%cd stock-hunter

# 執行
!python manpan_v4_1.py
```

---

## 📋 六大守護者說明

### Guardian 1: 市場熔斷器
- **目的：** 判斷大盤安全性
- **條件：**
  - 指數 < MA60（空頭格局）OR
  - 跌停 > 100 支（恐慌氣氛）
- **動作：** 觸發熔斷 → 停止買入 + 所有持倉強制出場

### Guardian 2: 流動性過濾
- **目的：** 過濾低流動性股票
- **條件：** 5 日平均成交金額 < 5000 萬台幣
- **額外：** 偵測爆量（量比 > 5x）

### Guardian 3: 籌碼共識
- **目的：** 追蹤三大法人動向
- **評分：**
  - 外資連 3 日買超 + 佔比 > 5%：+2 分
  - 投信連 3 日買超 + 佔比 > 3%：+2 分
  - 三大法人同步買超：+1 分
  - 外資投信雙賣超：-3 分

### Guardian 4: 技術過熱檢查
- **目的：** 避免追高
- **條件：**
  - 多頭格局：乖離率 > 30%（vs MA60）
  - 空頭格局：乖離率 > 15%
- **額外：** 檢查新聞情緒（MVP 用 Mock）

### Guardian 5: 出場策略
- **目的：** 動態停損停利
- **優先級：**
  1. 大盤熔斷（強制出場）
  2. 硬停損（持有 ≥ 3 天，虧損 -8%）
  3. 技術停損（破 MA20 且虧損）
  4. 移動停利（獲利 > 10% 後，從高點回落 > 10%）
  5. 獲利了結（+30%）

### Guardian 6: 倉位配置
- **目的：** 根據信心度決定買入比例
- **配置：**
  - 評分 ≥ 3：15% 倉位（高信心）
  - 評分 1-2：8% 倉位（中信心）
  - 評分 ≤ 0：不交易

---

## 🧪 測試場景切換

### 多頭場景（預設）

**預期結果：**
- ✅ 市場狀態：SAFE（允許買入）
- ✅ 通過篩選：1 支（2330 台積電，15%）
- ✅ 淘汰：4 支（流動性、過熱、籌碼）
- ✅ 持倉賣出：4 支（停損 1、停利 3）

### 空頭場景

**修改方式：**

打開 `manpan_v4_1.py`，找到 `main()` 函數：

```python
# 第 919 行
SCENARIO = "bull"  # 改為 "bear"
```

**預期結果：**
- 🔴 市場狀態：DANGER（觸發熔斷）
- 🚫 停止候選股票分析
- 🚨 所有持倉強制出場（MARKET_CRASH）

---

## 📊 Mock Data 說明

### 測試股票清單（5 支）

| 股票 | 測試情境 | 預期結果 |
|------|---------|---------|
| 2330 台積電 | 完美買點 | ✅ 通過（15% 倉位） |
| 9999 殭屍股 | 流動性陷阱 | 🚫 淘汰（成交額 3M） |
| 3324 雙鴻 | 技術過熱 | 🚫 淘汰（乖離 38.5%） |
| 2603 長榮 | 籌碼背離 | 🚫 淘汰（評分 0 分） |
| 2454 聯發科 | 爆量警示 | 🚫 淘汰（量比 5.6x + 評分 0） |

### 持倉清單（5 筆）

| 股票 | 測試情境 | 預期動作 |
|------|---------|---------|
| 2317 鴻海 | 獲利續抱 | ✅ HOLD（+15%） |
| 2603 長榮 | 硬停損 | ✂️ SELL（-9%） |
| 2330 台積電 | 移動停利 | 📊 SELL（從高點 630 回落 11.1%） |
| 2454 聯發科 | 技術停損 | 📉 SELL（破 MA20 且虧損） |
| 3711 日月光 | 獲利了結 | 🎯 SELL（+35%） |

---

## ⚙️ 參數調整

所有閾值集中在 `CONFIG` 字典（第 26-53 行）：

```python
CONFIG = {
    # Guardian 1: 市場熔斷
    "limit_down_threshold": 100,  # 跌停家數門檻

    # Guardian 2: 流動性
    "min_turnover": 50_000_000,   # 5000 萬台幣

    # Guardian 3: 籌碼
    "foreign_buy_ratio": 0.05,    # 外資買超佔比 5%
    "trust_buy_ratio": 0.03,      # 投信買超佔比 3%

    # Guardian 5: 出場
    "stop_loss": -0.08,           # -8% 停損
    "take_profit": 0.30,          # +30% 獲利了結

    # ... 其他參數
}
```

**調整建議：**
- 保守型：降低 `stop_loss` 至 -0.05（-5%）
- 激進型：提高 `take_profit` 至 0.50（+50%）

---

## 📈 輸出報告解讀

### 報告結構

```
📊 Manpan 情報網 v4.1 - 每日分析報告
============================================================

🌍 市場狀態檢查 (Guardian 1)
    → 🟢 SAFE 或 🔴 DANGER

🔍 候選股票分析 (Guardian 2-4-3-6)
    → 逐一展示過濾過程

📦 持倉健檢 (Guardian 5)
    → 出場動作建議

📊 執行摘要
    → 統計通過/淘汰數量
```

### Emoji 圖示說明

| 符號 | 意義 |
|------|------|
| 🟢 | 市場安全 / 通過 |
| 🔴 | 市場危險 / 失敗 |
| ✅ | 檢查通過 |
| 🚫 | 檢查失敗 / 淘汰 |
| ⚠️ | 警示 |
| 🔥 | 強力買入（評分 ≥ 3） |
| ⚡ | 適度買入（評分 1-2） |
| ✂️ | 硬停損 |
| 📊 | 移動停利 |
| 📉 | 技術停損 |
| 🎯 | 獲利了結 |
| 🚨 | 大盤熔斷 |

---

## 🔧 故障排除

### 問題 1：中文亂碼（Windows）

**症狀：** emoji 或中文顯示為 `???`

**解決：** 已內建編碼修正（第 18-20 行），確保使用 Python 3.7+

### 問題 2：執行無輸出

**檢查：**
1. 確認檔案完整（共 950+ 行）
2. 確認 `if __name__ == "__main__":` 在最後

### 問題 3：想修改測試數據

**位置：**
- 市場數據：`generate_market_data()` 函數（第 62-94 行）
- 候選股票：`generate_stock_candidates()` 函數（第 97-242 行）
- 持倉清單：`generate_portfolio()` 函數（第 245-307 行）

---

## 🚀 下一步：LINE BOT 版本

### 當前狀態
✅ **已完成：MVP 邏輯驗證**
- 六大守護者運作正常
- Mock Data 測試通過

### 未來開發（Phase 2）

#### 技術堆疊
```
Python Flask (Web 框架)
  ↓
LINE Messaging API
  ↓
六大守護者邏輯（已完成）
  ↓
FinMind API（真實台股資料）
  ↓
SQLite（持倉記錄）
```

#### 部署架構
```
GitHub Repo
  ↓
Zeabur 自動部署
  ↓
LINE Bot 24/7 運行
```

#### 功能設計

| 用戶輸入 | BOT 回應 |
|---------|---------|
| `分析` | 執行六大守護者 → 回傳報告 |
| `2330` | 分析台積電 → 單一股票評分 |
| `持倉` | 回傳持倉健檢 |
| `大盤` | Guardian 1 市場狀態 |
| `新增 2330 100 600` | 記錄持倉（股票 ID、張數、成本） |
| `幫助` | 使用說明 |

#### 所需資料

**LINE Developers：**
- Channel Secret
- Channel Access Token

**FinMind API：**
- 註冊免費帳號：https://finmind.github.io/
- 取得 API Token

---

## 📝 檔案清單

```
D:\claude-project\STOCK_HUNTER\
│
├── manpan_v4_1.py           # 主程式（本檔案）
├── FINAL_SPEC.md            # 完整規格書
├── Q.md                     # 專業審查報告
├── README_COLAB.md          # 使用指南（本檔案）
│
└── FEEDBACK1.txt            # AI 反饋 1
└── FEEDBACK2.txt            # AI 反饋 2
```

---

## ⚡ 快速測試指令

### 本地執行
```bash
python manpan_v4_1.py
```

### Google Colab
```python
!python manpan_v4_1.py
```

### 切換場景
```python
# 編輯第 919 行
SCENARIO = "bull"  # 多頭
SCENARIO = "bear"  # 空頭
```

---

## 📞 支援

**問題回報：**
- 參考 `FINAL_SPEC.md` 的完整規格
- 參考 `Q.md` 的專業審查報告

**未來擴展：**
- Phase 2: LINE BOT + 真實資料（FinMind API）
- Phase 3: 新聞情緒 AI（Guardian 0 + Gemini API）
- Phase 4: 回測引擎（驗證歷史績效）

---

**版本：** v4.1 MVP
**更新日期：** 2025-12-01
**狀態：** ✅ 已測試（多頭 + 空頭場景）
