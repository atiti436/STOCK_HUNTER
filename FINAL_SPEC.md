# Manpan æƒ…å ±ç¶² v4.1 - æœ€çµ‚å®šæ¡ˆè¦æ ¼æ›¸

**æ–‡ä»¶ç‰ˆæœ¬ï¼š** v1.0 Final
**åˆ¶å®šæ—¥æœŸï¼š** 2025-12-01
**æ•´åˆä¾†æºï¼š**
- åŸå§‹è¦æ ¼æ›¸ï¼ˆæƒ…å ±ç¶² v4.0ï¼‰
- å°ˆæ¥­å¯©æŸ¥å ±å‘Šï¼ˆQ.mdï¼‰
- FEEDBACK1ï¼ˆv4.1 ç²¾ç°¡ç‰ˆï¼‰
- FEEDBACK2ï¼ˆä¸­æ–‡å¯¦ä½œè¨ˆç•«ï¼‰

---

## ğŸ“‹ ç›®éŒ„

1. [å°ˆæ¡ˆæ¦‚è¿°](#å°ˆæ¡ˆæ¦‚è¿°)
2. [ç³»çµ±æ¶æ§‹](#ç³»çµ±æ¶æ§‹)
3. [å…­å¤§å®ˆè­·è€…è©³ç´°è¦æ ¼](#å…­å¤§å®ˆè­·è€…è©³ç´°è¦æ ¼)
4. [Mock Data å®Œæ•´è¦æ ¼](#mock-data-å®Œæ•´è¦æ ¼)
5. [è¼¸å‡ºå ±å‘Šæ ¼å¼](#è¼¸å‡ºå ±å‘Šæ ¼å¼)
6. [æŠ€è¡“ç´„æŸ](#æŠ€è¡“ç´„æŸ)
7. [é–‹ç™¼æª¢æŸ¥æ¸…å–®](#é–‹ç™¼æª¢æŸ¥æ¸…å–®)

---

## ğŸ“Š å°ˆæ¡ˆæ¦‚è¿°

### å°ˆæ¡ˆç›®æ¨™
å»ºç«‹ä¸€å€‹ã€Œæ©Ÿæ§‹ç­‰ç´šã€çš„è‚¡ç¥¨åˆ†æç³»çµ±ï¼Œé€éå…­å¤§å®ˆè­·è€…é‚è¼¯å±¤å±¤éæ¿¾ï¼Œæ‰¾å‡ºé«˜å‹ç‡æ¨™çš„ä¸¦ç®¡ç†é¢¨éšªã€‚

### æ ¸å¿ƒç†å¿µ
```
Guardian 1 (å¸‚å ´ç†”æ–·) â†’ åˆ¤æ–·å¤§ç›¤å®‰å…¨æ€§
    â†“ PASS
Guardian 2-4 (å€‹è‚¡ç¯©é¸) â†’ æµå‹•æ€§ + ç±Œç¢¼ + æŠ€è¡“
    â†“ è¨ˆç®—è©•åˆ†
Guardian 6 (å€‰ä½é…ç½®) â†’ æ ¹æ“šä¿¡å¿ƒåº¦æ±ºå®šæ¯”ä¾‹
    â†“ æŒå€‰ç®¡ç†
Guardian 5 (å‡ºå ´ç­–ç•¥) â†’ å‹•æ…‹åœæåœåˆ©
```

### MVP ç¯„åœ
- âœ… ç´” Python æ¨™æº–åº«ï¼ˆç„¡éœ€å¤–éƒ¨å¥—ä»¶ï¼‰
- âœ… Mock Data æ¨¡æ“¬ï¼ˆä¸ä¸²æ¥çœŸå¯¦ APIï¼‰
- âœ… å–®ä¸€æª”æ¡ˆè…³æœ¬ï¼ˆæ–¹ä¾¿åŸ·è¡Œï¼‰
- âœ… å®Œæ•´é‚è¼¯å±•ç¤ºï¼ˆå«æ‰€æœ‰ Guardianï¼‰
- âŒ æš«ä¸å¯¦ä½œï¼šæ–°èæƒ…ç·’ AIï¼ˆPhase 2ï¼‰
- âŒ æš«ä¸å¯¦ä½œï¼šå›æ¸¬å¼•æ“ï¼ˆPhase 3ï¼‰

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### æª”æ¡ˆçµæ§‹ï¼ˆå–®ä¸€è…³æœ¬ï¼‰

```
manpan_v4_1.py          # ä¸»ç¨‹å¼ï¼ˆåŒ…å«æ‰€æœ‰é‚è¼¯ï¼‰
```

### ç¨‹å¼æ¨¡çµ„åŠƒåˆ†ï¼ˆå‡½æ•¸å±¤ç´šï¼‰

```python
# 1. é…ç½®å€
CONFIG = {...}          # æ‰€æœ‰é–¾å€¼åƒæ•¸

# 2. Mock Data ç”Ÿæˆ
def generate_market_data()
def generate_stock_candidates()
def generate_portfolio()

# 3. å…­å¤§å®ˆè­·è€…
def guardian_1_market_check(market_data)
def guardian_2_liquidity_check(stock)
def guardian_3_chips_consensus(stock)
def guardian_4_technical_check(stock)
def guardian_5_exit_strategy(position, stock, market_status)
def guardian_6_position_sizing(score)

# 4. ä¸»æµç¨‹
def analyze_watchlist(stocks, market_data)
def check_portfolio(holdings, market_data)
def main()

# 5. è¼¸å‡º
def print_report(...)
```

---

## ğŸ›¡ï¸ å…­å¤§å®ˆè­·è€…è©³ç´°è¦æ ¼

### Guardian 1: å¸‚å ´ç†”æ–·å™¨ (Market Circuit Breaker)

#### ç›®çš„
åˆ¤æ–·å¤§ç›¤æ˜¯å¦å®‰å…¨ï¼Œé¿å…é€†å‹¢æ“ä½œ

#### è¼¸å…¥æ•¸æ“š
```python
market_data = {
    "index_name": "å°ç£åŠ æ¬ŠæŒ‡æ•¸ (TAIEX)",
    "current_price": 17500,      # ç•¶å‰æŒ‡æ•¸
    "ma60": 17200,               # è¿‘ 60 äº¤æ˜“æ—¥æ”¶ç›¤åƒ¹å¹³å‡
    "limit_down_count": 85,      # ç•¶æ—¥è·Œå¹… > 9.5% è‚¡ç¥¨å®¶æ•¸
    "date": "2025-12-01"
}
```

#### åˆ¤æ–·é‚è¼¯
```python
def guardian_1_market_check(market_data):
    """
    å¸‚å ´ç†”æ–·æª¢æŸ¥
    """
    # æ¢ä»¶ 1: å¤§ç›¤è·Œç ´å­£ç·šï¼ˆç©ºé ­æ ¼å±€ï¼‰
    below_ma60 = market_data['current_price'] < market_data['ma60']

    # æ¢ä»¶ 2: è·Œåœå®¶æ•¸éå¤šï¼ˆææ…Œæ°£æ°›ï¼‰
    panic_mode = market_data['limit_down_count'] > 100

    # ä»»ä¸€æ¢ä»¶æˆç«‹ â†’ ç†”æ–·
    if below_ma60 or panic_mode:
        return {
            "status": "DANGER",
            "action": "HALT_ALL_BUYING",
            "reason": f"å¤§ç›¤ < MA60" if below_ma60 else f"è·Œåœ {market_data['limit_down_count']} æ”¯"
        }

    return {
        "status": "SAFE",
        "action": "ALLOW_BUYING",
        "reason": "å¸‚å ´æ­£å¸¸"
    }
```

#### åƒæ•¸å®šç¾©

| åƒæ•¸ | å€¼ | èªªæ˜ |
|------|---|------|
| `index_name` | TAIEX | å°ç£åŠ æ¬ŠæŒ‡æ•¸ |
| `ma60` è¨ˆç®—æ–¹å¼ | è¿‘ 60 äº¤æ˜“æ—¥æ”¶ç›¤åƒ¹å¹³å‡ | ä»£è¡¨å­£ç·š |
| `limit_down_count` å®šç¾© | ç•¶æ—¥è·Œå¹… â‰¥ 9.5% è‚¡ç¥¨æ•¸é‡ | å°è‚¡è·Œåœæ¿æ¨™æº– |
| `limit_down_count` é–€æª» | > 100 æ”¯ | ç´„ä½”å¸‚å ´ 6%ï¼ˆ1700 æ”¯è‚¡ç¥¨ï¼‰ |

---

### Guardian 2: æµå‹•æ€§éæ¿¾ (Liquidity Gate)

#### ç›®çš„
éæ¿¾ä½æµå‹•æ€§è‚¡ç¥¨ï¼Œé¿å…ã€Œæœ‰åƒ¹ç„¡å¸‚ã€é™·é˜±

#### è¼¸å…¥æ•¸æ“š
```python
stock = {
    "id": "2330",
    "name": "å°ç©é›»",
    "price": 580,
    "avg_volume_5d": 25000,        # è¿‘ 5 æ—¥å¹³å‡æˆäº¤é‡ï¼ˆå¼µï¼‰
    "avg_turnover_5d": 145000000,  # è¿‘ 5 æ—¥å¹³å‡æˆäº¤é‡‘é¡ï¼ˆå°å¹£ï¼‰
    "today_volume": 30000,
    # ...
}
```

#### åˆ¤æ–·é‚è¼¯
```python
def guardian_2_liquidity_check(stock):
    """
    æµå‹•æ€§æª¢æŸ¥ï¼ˆä½¿ç”¨æˆäº¤é‡‘é¡ï¼Œè€Œéå–®ç´”æˆäº¤é‡ï¼‰
    """
    # ä¸»è¦æ¢ä»¶ï¼š5 æ—¥å¹³å‡æˆäº¤é‡‘é¡
    turnover_pass = stock['avg_turnover_5d'] >= 50_000_000  # 5000 è¬

    # è¼”åŠ©æª¢æŸ¥ï¼šçˆ†é‡åµæ¸¬ï¼ˆå¯èƒ½æ˜¯å‡ºè²¨è¨Šè™Ÿï¼‰
    volume_ratio = stock['today_volume'] / stock['avg_volume_5d']
    abnormal_spike = volume_ratio > 5

    if not turnover_pass:
        return {
            "pass": False,
            "reason": f"æµå‹•æ€§ä¸è¶³ï¼ˆæ—¥å‡ {stock['avg_turnover_5d']/1e6:.1f}M < 50Mï¼‰"
        }

    if abnormal_spike:
        return {
            "pass": True,
            "warning": f"âš ï¸ ç•°å¸¸çˆ†é‡ï¼ˆé‡æ¯” {volume_ratio:.1f}xï¼‰"
        }

    return {
        "pass": True,
        "reason": "æµå‹•æ€§å……è¶³"
    }
```

#### åƒæ•¸å®šç¾©

| åƒæ•¸ | å€¼ | èªªæ˜ |
|------|---|------|
| `avg_turnover_5d` é–€æª» | â‰¥ 50,000,000 TWD | 5000 è¬å°å¹£ |
| çˆ†é‡é–€æª» | é‡æ¯” > 5 å€ | ä»Šæ—¥é‡ / 5æ—¥å‡é‡ |
| è¨ˆç®—é€±æœŸ | è¿‘ 5 å€‹äº¤æ˜“æ—¥ | æ’é™¤å‡æ—¥ |

**ç‚ºä½•ç”¨æˆäº¤é‡‘é¡ï¼Ÿ**
- âŒ éŒ¯èª¤ï¼šæˆäº¤é‡ 1000 å¼µ
  - 3 å…ƒè‚¡ç¥¨ï¼š300 è¬ï¼ˆæµå‹•æ€§å·®ï¼‰
  - 1000 å…ƒè‚¡ç¥¨ï¼š1 å„„ï¼ˆæµå‹•æ€§å¥½ï¼‰
- âœ… æ­£ç¢ºï¼šæˆäº¤é‡‘é¡ 5000 è¬ï¼ˆçµ±ä¸€æ¨™æº–ï¼‰

---

### Guardian 3: ç±Œç¢¼å…±è­˜ (Chips Consensus)

#### ç›®çš„
è¿½è¹¤ä¸‰å¤§æ³•äººå‹•å‘ï¼Œåˆ¤æ–·ç±Œç¢¼å¼·å¼±

#### è¼¸å…¥æ•¸æ“š
```python
stock = {
    # ... åŸºæœ¬è³‡æ–™
    "chips": {
        "foreign": {
            "buy_days": 5,              # é€£çºŒè²·è¶…å¤©æ•¸
            "today_amount": 150000000,  # ä»Šæ—¥è²·è¶…é‡‘é¡ï¼ˆå°å¹£ï¼‰
            "today_ratio": 0.08         # è²·è¶…ä½”ç•¶æ—¥æˆäº¤æ¯” 8%
        },
        "trust": {
            "buy_days": 3,
            "today_amount": 50000000,
            "today_ratio": 0.03
        },
        "dealer": {
            "buy_days": 0,              # è‡ªç‡Ÿå•†ï¼ˆé¿éšªï¼‰
            "today_amount": -20000000,  # è² æ•¸ = è³£è¶…
            "today_ratio": -0.01
        }
    },
    "total_turnover_today": 1800000000  # ç•¶æ—¥ç¸½æˆäº¤é¡
}
```

#### åˆ¤æ–·é‚è¼¯
```python
def guardian_3_chips_consensus(stock):
    """
    ç±Œç¢¼è©•åˆ†ç³»çµ±ï¼ˆ-3 åˆ° +3 åˆ†ï¼‰
    """
    foreign = stock['chips']['foreign']
    trust = stock['chips']['trust']
    dealer = stock['chips']['dealer']

    score = 0
    reasons = []

    # === åŠ åˆ†æ¢ä»¶ ===

    # 1. å¤–è³‡å¼·åŠ›è²·è¶…ï¼ˆé€£çºŒ 3 å¤© + ä½”æ¯” > 5%ï¼‰
    if foreign['buy_days'] >= 3 and foreign['today_ratio'] > 0.05:
        score += 2
        reasons.append(f"å¤–è³‡é€£{foreign['buy_days']}æ—¥è²·è¶…ï¼ˆä½”æ¯”{foreign['today_ratio']:.1%}ï¼‰")

    # 2. æŠ•ä¿¡å¼·åŠ›è²·è¶…ï¼ˆé€£çºŒ 3 å¤© + ä½”æ¯” > 3%ï¼‰
    if trust['buy_days'] >= 3 and trust['today_ratio'] > 0.03:
        score += 2
        reasons.append(f"æŠ•ä¿¡é€£{trust['buy_days']}æ—¥è²·è¶…ï¼ˆä½”æ¯”{trust['today_ratio']:.1%}ï¼‰")

    # 3. ä¸‰å¤§æ³•äººåŒæ­¥è²·è¶…ï¼ˆç•¶æ—¥ï¼‰
    all_buying = (foreign['today_ratio'] > 0 and
                  trust['today_ratio'] > 0 and
                  dealer['today_ratio'] > 0)
    if all_buying:
        score += 1
        reasons.append("ä¸‰å¤§æ³•äººåŒæ­¥è²·è¶…")

    # === æ‰£åˆ†æ¢ä»¶ ===

    # 4. å¤–è³‡+æŠ•ä¿¡é›™è³£è¶…
    both_selling = (foreign['today_ratio'] < -0.03 and
                    trust['today_ratio'] < -0.02)
    if both_selling:
        score -= 3
        reasons.append("å¤–è³‡æŠ•ä¿¡é›™è³£è¶…ï¼ˆè­¦ç¤ºï¼‰")

    # === è©•ç´š ===
    if score >= 3:
        level = "STRONG_CONSENSUS"  # å¼·åŠ›å…±è­˜
    elif score > 0:
        level = "MODERATE"           # æº«å’Œè²·ç›¤
    elif score == 0:
        level = "NEUTRAL"            # ä¸­æ€§
    else:
        level = "AVOID"              # é¿é–‹

    return {
        "score": score,
        "level": level,
        "reasons": reasons
    }
```

#### åƒæ•¸å®šç¾©

| åƒæ•¸ | å€¼ | èªªæ˜ |
|------|---|------|
| é€£çºŒè²·è¶…é–€æª» | â‰¥ 3 æ—¥ | é¿å…éš”æ—¥æ²–å‡è±¡ |
| å¤–è³‡è²·è¶…ä½”æ¯” | > 5% | è²·è¶…é‡‘é¡ / ç•¶æ—¥æˆäº¤é¡ |
| æŠ•ä¿¡è²·è¶…ä½”æ¯” | > 3% | æŠ•ä¿¡è³‡é‡‘ç›¸å°è¼ƒå° |
| æ˜¯å¦ç´å…¥è‡ªç‡Ÿå•† | âœ… æ˜¯ | è§€å¯Ÿé¿éšªå‹•å‘ |

#### è©•åˆ†è¡¨

| æƒ…å¢ƒ | è©•åˆ† | èªªæ˜ |
|------|------|------|
| å¤–è³‡é€£ 3 æ—¥è²·è¶… + ä½”æ¯” > 5% | +2 | å¼·åŠ›è²·ç›¤ |
| æŠ•ä¿¡é€£ 3 æ—¥è²·è¶… + ä½”æ¯” > 3% | +2 | å¼·åŠ›è²·ç›¤ |
| ä¸‰å¤§æ³•äººç•¶æ—¥åŒæ­¥è²·è¶… | +1 | å…±è­˜ |
| å¤–è³‡æŠ•ä¿¡é›™è³£è¶…ï¼ˆä½”æ¯” > 3%/2%ï¼‰ | -3 | é¿é–‹ |

---

### Guardian 4: æŠ€è¡“éç†±æª¢æŸ¥ (Technical Pattern)

#### ç›®çš„
é¿å…è¿½é«˜ï¼Œåˆ¤æ–·è‚¡åƒ¹æ˜¯å¦éåº¦åé›¢å‡ç·š

#### è¼¸å…¥æ•¸æ“š
```python
stock = {
    # ... åŸºæœ¬è³‡æ–™
    "price": 600,
    "ma20": 580,
    "ma60": 550,
    "ma120": 520,
    # Mock æ–°èåˆ†æ•¸ï¼ˆMVP éšæ®µç”¨éš¨æ©Ÿæ•¸æ¨¡æ“¬ï¼‰
    "news_score": 0.6  # -1ï¼ˆæ¥µè² é¢ï¼‰ ~ +1ï¼ˆæ¥µæ­£é¢ï¼‰
}
```

#### åˆ¤æ–·é‚è¼¯
```python
def guardian_4_technical_check(stock):
    """
    æŠ€è¡“é¢ + æ–°èæƒ…ç·’æª¢æŸ¥
    """
    # è¨ˆç®—ä¹–é›¢ç‡ï¼ˆä½¿ç”¨ MA60 ä½œç‚ºåŸºæº–ï¼‰
    bias_60 = (stock['price'] - stock['ma60']) / stock['ma60']

    # åˆ¤æ–·å¤šç©ºæ ¼å±€
    is_bullish = (stock['ma20'] > stock['ma60'] > stock['ma120'])

    # === éç†±åˆ¤æ–· ===
    if is_bullish:
        # å¤šé ­å¸‚å ´ï¼šå…è¨±è¼ƒé«˜ä¹–é›¢
        overheated = bias_60 > 0.30  # 30%
    else:
        # ç©ºé ­/ç›¤æ•´ï¼šåš´æ ¼æ¨™æº–
        overheated = bias_60 > 0.15  # 15%

    # === æ–°èæƒ…ç·’æª¢æŸ¥ï¼ˆMVP ç”¨ Mockï¼‰===
    news_negative = stock.get('news_score', 0) < -0.3

    # === å›å‚³çµæœ ===
    if overheated:
        return {
            "pass": False,
            "reason": f"æŠ€è¡“éç†±ï¼ˆä¹–é›¢ {bias_60:.1%} > é–€æª»ï¼‰"
        }

    if news_negative:
        return {
            "pass": False,
            "reason": f"è² é¢æ–°èï¼ˆåˆ†æ•¸ {stock['news_score']:.2f}ï¼‰"
        }

    return {
        "pass": True,
        "bias": bias_60,
        "trend": "å¤šé ­" if is_bullish else "ç©ºé ­/ç›¤æ•´"
    }
```

#### åƒæ•¸å®šç¾©

| åƒæ•¸ | å€¼ | èªªæ˜ |
|------|---|------|
| ä¹–é›¢ç‡åŸºæº– | MA60 | å­£ç·šï¼ˆæ¯” MA20 ç©©å®šï¼‰ |
| å¤šé ­ä¹–é›¢é–€æª» | > 30% | å¼·å‹¢è‚¡å…è¨±è¼ƒé«˜åé›¢ |
| ç©ºé ­ä¹–é›¢é–€æª» | > 15% | ç›¤æ•´æœŸåš´æ ¼ |
| æ–°èæƒ…ç·’é–€æª» | < -0.3 | MVP ç”¨ Mockï¼ŒPhase 2 ç”¨ Gemini API |

---

### Guardian 5: å‡ºå ´ç­–ç•¥ (The Reaper)

#### ç›®çš„
å‹•æ…‹ç®¡ç†æŒå€‰ï¼ŒåŸ·è¡Œåœæ/åœåˆ©

#### è¼¸å…¥æ•¸æ“š
```python
position = {
    "stock_id": "2603",
    "stock_name": "é•·æ¦®",
    "cost_price": 100,              # è²·å…¥æˆæœ¬
    "buy_date": "2025-11-20",
    "current_price": 91,             # ç•¶å‰åƒ¹æ ¼
    "max_price_since_buy": 105,     # è²·å…¥å¾Œæœ€é«˜åƒ¹
    "holding_days": 11,              # æŒæœ‰å¤©æ•¸
    "ma20": 95                       # ç•¶å‰ 20MA
}

market_status = "SAFE"  # Guardian 1 çš„çµæœ
```

#### åˆ¤æ–·é‚è¼¯ï¼ˆå®Œæ•´ç‰ˆï¼‰
```python
from datetime import datetime

def guardian_5_exit_strategy(position, market_status):
    """
    å‡ºå ´ç­–ç•¥ï¼ˆäº”å±¤æª¢æŸ¥ï¼‰
    """
    current = position['current_price']
    cost = position['cost_price']
    max_high = position['max_price_since_buy']
    holding_days = position['holding_days']

    # è¨ˆç®—æŒ‡æ¨™
    pnl_ratio = (current - cost) / cost
    drawdown_from_peak = (max_high - current) / max_high
    highest_profit = (max_high - cost) / cost

    # === ç¬¬ 1 å±¤ï¼šå¤§ç›¤ç†”æ–·ï¼ˆæœ€å„ªå…ˆï¼‰===
    if market_status == "DANGER":
        return {
            "action": "SELL",
            "reason": "ğŸš¨ å¤§ç›¤ç†”æ–·ï¼Œå¼·åˆ¶å‡ºå ´",
            "type": "MARKET_CRASH"
        }

    # === ç¬¬ 2 å±¤ï¼šç¡¬åœæï¼ˆæŒæœ‰ >= 3 å¤©æ‰å•Ÿå‹•ï¼‰===
    if holding_days >= 3 and pnl_ratio <= -0.08:
        return {
            "action": "SELL",
            "reason": f"âœ‚ï¸ ç¡¬åœæ -8%ï¼ˆç›®å‰ {pnl_ratio:.1%}ï¼‰",
            "type": "STOP_LOSS"
        }

    # === ç¬¬ 3 å±¤ï¼šæŠ€è¡“åœæï¼ˆç ´ç·šä¸”è™§æï¼‰===
    if current < position['ma20'] and pnl_ratio < 0:
        return {
            "action": "SELL",
            "reason": f"ğŸ“‰ è·Œç ´æœˆç·šä¸”è™§æï¼ˆ{pnl_ratio:.1%}ï¼‰",
            "type": "TECH_BREAK"
        }

    # === ç¬¬ 4 å±¤ï¼šç§»å‹•åœåˆ©ï¼ˆä¿ä½ç²åˆ©ï¼‰===
    # æ¢ä»¶ï¼šæ›¾ç¶“ç²åˆ© > 10%ï¼Œä¸”å¾é«˜é»å›è½ > 10%
    if highest_profit > 0.10 and drawdown_from_peak > 0.10:
        return {
            "action": "SELL",
            "reason": f"ğŸ“Š ç§»å‹•åœåˆ©ï¼ˆé«˜é»å›è½ {drawdown_from_peak:.1%}ï¼‰",
            "type": "TRAILING_STOP"
        }

    # === ç¬¬ 5 å±¤ï¼šç²åˆ©äº†çµ ===
    if pnl_ratio >= 0.30:
        return {
            "action": "SELL",
            "reason": f"ğŸ¯ ç²åˆ©é”æ¨™ +30%ï¼ˆç›®å‰ {pnl_ratio:.1%}ï¼‰",
            "type": "TAKE_PROFIT"
        }

    # === çºŒæŠ± ===
    return {
        "action": "HOLD",
        "reason": f"æŒæœ‰ä¸­ï¼ˆæç›Š {pnl_ratio:.1%}ï¼‰",
        "type": "HOLD"
    }
```

#### åƒæ•¸å®šç¾©

| åƒæ•¸ | å€¼ | èªªæ˜ |
|------|---|------|
| `cost_price` ä¾†æº | Mock Portfolio å­—å…¸ | MVP éšæ®µæ‰‹å‹•æä¾› |
| `max_price_since_buy` å®šç¾© | è²·å…¥å¾Œè‡³ä»Šæœ€é«˜æ”¶ç›¤åƒ¹ | æ¯æ—¥æ›´æ–° |
| ç¡¬åœæ | -8% | æŒæœ‰ â‰¥ 3 å¤©å¾Œæ‰å•Ÿå‹• |
| æŠ€è¡“åœæ | è·Œç ´ MA20 ä¸”è™§æ | é›™æ¢ä»¶ AND |
| ç§»å‹•åœåˆ©è§¸ç™¼æ¢ä»¶ | æ›¾ç²åˆ© > 10% | é¿å…å°æ³¢å‹•å°±è³£ |
| ç§»å‹•åœåˆ©åŸ·è¡Œæ¢ä»¶ | å¾é«˜é»å›è½ > 10% | ä¿ä½å¤§éƒ¨åˆ†ç²åˆ© |
| ç²åˆ©äº†çµ | +30% | æ»¿è¶³å³å‡º |
| å¤§ç›¤ç†”æ–·å„ªå…ˆæ¬Š | æœ€é«˜ | ä¸è«–ç›ˆè™§éƒ½å‡ºå ´ |

#### å‡ºå ´å„ªå…ˆç´š
```
1. å¤§ç›¤ç†”æ–·ï¼ˆDANGERï¼‰
2. ç¡¬åœæï¼ˆ-8%ï¼‰
3. æŠ€è¡“åœæï¼ˆç ´ç·šä¸”è™§ï¼‰
4. ç§»å‹•åœåˆ©ï¼ˆå¾é«˜é»å›è½ 10%ï¼‰
5. ç²åˆ©äº†çµï¼ˆ+30%ï¼‰
6. çºŒæŠ±ï¼ˆHOLDï¼‰
```

---

### Guardian 6: å€‰ä½é…ç½® (Position Sizing)

#### ç›®çš„
æ ¹æ“š Guardian 3 çš„è©•åˆ†ï¼Œæ±ºå®šè²·å…¥æ¯”ä¾‹

#### è¼¸å…¥æ•¸æ“š
```python
chips_score = 3  # Guardian 3 çš„è©•åˆ†çµæœ
```

#### åˆ¤æ–·é‚è¼¯
```python
def guardian_6_position_sizing(chips_score):
    """
    å€‰ä½é…ç½®ï¼ˆä¿å®ˆæ©Ÿæ§‹ç‰ˆï¼‰
    """
    if chips_score >= 3:
        return {
            "allocation": 0.15,  # 15%
            "confidence": "HIGH",
            "description": "ğŸ”¥ å¼·åŠ›è²·å…¥"
        }
    elif chips_score > 0:
        return {
            "allocation": 0.08,  # 8%
            "confidence": "MEDIUM",
            "description": "âš¡ é©åº¦è²·å…¥"
        }
    else:
        return {
            "allocation": 0,
            "confidence": "NONE",
            "description": "ğŸš« ä¸äº¤æ˜“"
        }
```

#### åƒæ•¸å®šç¾©

| è©•åˆ†ç¯„åœ | å€‰ä½é…ç½® | ä¿¡å¿ƒç­‰ç´š |
|---------|---------|---------|
| â‰¥ 3 åˆ† | 15% | HIGHï¼ˆåŸ 20% å¤ªæ¿€é€²ï¼‰ |
| 1-2 åˆ† | 8% | MEDIUMï¼ˆåŸ 10%ï¼‰ |
| â‰¤ 0 åˆ† | 0% | NONE |

**ç‚ºä½•èª¿é™æ¯”ä¾‹ï¼Ÿ**
- åŸè¦æ ¼ï¼šå–®ä¸€è‚¡ç¥¨ 20%ï¼Œ5 æ”¯å°±æ»¿å€‰
- èª¿æ•´å¾Œï¼šå–®ä¸€è‚¡ç¥¨ 15%ï¼Œè‡³å°‘ 7 æ”¯æ‰æ»¿å€‰
- ç›®çš„ï¼šåˆ†æ•£é¢¨éšªï¼Œé¿å…å–®ä¸€è‚¡ç¥¨æš´é›·

---

## ğŸ“¦ Mock Data å®Œæ•´è¦æ ¼

### 4.1 å¸‚å ´æ•¸æ“š (Market Data)

```python
def generate_market_data(scenario="bull"):
    """
    ç”Ÿæˆå¤§ç›¤æ•¸æ“š
    scenario: "bull" (å¤šé ­) æˆ– "bear" (ç©ºé ­)
    """
    if scenario == "bull":
        return {
            "index_name": "å°ç£åŠ æ¬ŠæŒ‡æ•¸",
            "current_price": 17500,
            "ma60": 17200,
            "limit_down_count": 35,  # æ­£å¸¸ç¯„åœ
            "date": "2025-12-01",
            "status_note": "å¤šé ­æ ¼å±€ï¼ˆæŒ‡æ•¸ > MA60ï¼‰"
        }
    else:  # bear
        return {
            "index_name": "å°ç£åŠ æ¬ŠæŒ‡æ•¸",
            "current_price": 16800,
            "ma60": 17200,
            "limit_down_count": 120,  # ææ…Œ
            "date": "2025-12-01",
            "status_note": "ç©ºé ­æ ¼å±€ï¼ˆæŒ‡æ•¸ < MA60ï¼Œè·Œåœ > 100ï¼‰"
        }
```

---

### 4.2 å€™é¸è‚¡ç¥¨æ¸…å–® (Stock Candidates)

å¿…é ˆåŒ…å«ä»¥ä¸‹æ¸¬è©¦æ¡ˆä¾‹ï¼š

#### Stock A - å®Œç¾è²·é»
```python
{
    "id": "2330",
    "name": "å°ç©é›»",
    "price": 580,
    "ma20": 565,
    "ma60": 550,
    "ma120": 520,
    "avg_volume_5d": 25000,
    "avg_turnover_5d": 145000000,  # 1.45 å„„ï¼ˆPassï¼‰
    "today_volume": 28000,
    "news_score": 0.7,  # æ­£é¢æ–°è
    "chips": {
        "foreign": {"buy_days": 5, "today_amount": 150000000, "today_ratio": 0.08},
        "trust": {"buy_days": 4, "today_amount": 50000000, "today_ratio": 0.03},
        "dealer": {"buy_days": 1, "today_amount": 10000000, "today_ratio": 0.01}
    },
    "total_turnover_today": 1800000000
}
# é æœŸçµæœï¼š
# - Guardian 2: PASSï¼ˆæˆäº¤é¡ > 50Mï¼‰
# - Guardian 3: è©•åˆ† +4ï¼ˆå¤–è³‡+æŠ•ä¿¡é€£çºŒè²·è¶…ï¼‰
# - Guardian 4: PASSï¼ˆä¹–é›¢ 5.4%ï¼‰
# - Guardian 6: 15% é…ç½®
```

#### Stock B - æµå‹•æ€§é™·é˜±
```python
{
    "id": "9999",
    "name": "æ®­å±è‚¡",
    "price": 15,
    "avg_turnover_5d": 3000000,  # 300 è¬ï¼ˆFailï¼‰
    # ...å…¶ä»–æ•¸æ“šè‰¯å¥½
}
# é æœŸçµæœï¼šGuardian 2 ç›´æ¥æ·˜æ±°
```

#### Stock C - æŠ€è¡“éç†±
```python
{
    "id": "3324",
    "name": "é›™é´»",
    "price": 720,
    "ma60": 520,
    "avg_turnover_5d": 80000000,
    "chips": {
        # ç±Œç¢¼è‰¯å¥½
    }
}
# è¨ˆç®—ï¼š(720 - 520) / 520 = 38.5% > 30%
# é æœŸçµæœï¼šGuardian 4 æ·˜æ±°ï¼ˆéç†±ï¼‰
```

#### Stock D - ç±Œç¢¼èƒŒé›¢
```python
{
    "id": "2603",
    "name": "é•·æ¦®",
    "price": 150,
    "ma60": 145,
    "avg_turnover_5d": 200000000,
    "chips": {
        "foreign": {"buy_days": 0, "today_amount": -50000000, "today_ratio": -0.05},
        "trust": {"buy_days": 0, "today_amount": -20000000, "today_ratio": -0.02},
        "dealer": {"buy_days": 2, "today_amount": 5000000, "today_ratio": 0.01}
    }
}
# é æœŸçµæœï¼šGuardian 3 è©•åˆ† -3ï¼ˆé›™è³£è¶…ï¼‰
```

#### Stock E - çˆ†é‡è­¦ç¤º
```python
{
    "id": "2454",
    "name": "è¯ç™¼ç§‘",
    "price": 1020,
    "avg_volume_5d": 5000,
    "today_volume": 28000,  # é‡æ¯” 5.6x
    "avg_turnover_5d": 51000000,
    "chips": {
        # ä¸­æ€§
    }
}
# é æœŸçµæœï¼šGuardian 2 é€šéä½†è­¦ç¤ºçˆ†é‡
```

---

### 4.3 æŒå€‰æ¸…å–® (Portfolio Holdings)

å¿…é ˆåŒ…å«ä»¥ä¸‹æ¸¬è©¦æ¡ˆä¾‹ï¼š

#### Holding A - ç²åˆ©çºŒæŠ±
```python
{
    "stock_id": "2317",
    "stock_name": "é´»æµ·",
    "cost_price": 100,
    "current_price": 115,
    "buy_date": "2025-11-10",
    "holding_days": 21,
    "max_price_since_buy": 120,
    "ma20": 110
}
# è¨ˆç®—ï¼š
# - æç›Šï¼š+15%
# - å¾é«˜é»å›è½ï¼š(120-115)/120 = 4.2%ï¼ˆæœªé” 10%ï¼‰
# é æœŸçµæœï¼šHOLDï¼ˆçºŒæŠ±ï¼‰
```

#### Holding B - ç¡¬åœæ
```python
{
    "stock_id": "2603",
    "stock_name": "é•·æ¦®",
    "cost_price": 100,
    "current_price": 91,
    "buy_date": "2025-11-25",
    "holding_days": 6,
    "max_price_since_buy": 102,
    "ma20": 95
}
# è¨ˆç®—ï¼š
# - æç›Šï¼š-9%ï¼ˆ< -8%ï¼‰
# - æŒæœ‰å¤©æ•¸ï¼š6ï¼ˆâ‰¥ 3ï¼‰
# é æœŸçµæœï¼šSELLï¼ˆç¡¬åœæï¼‰
```

#### Holding C - ç§»å‹•åœåˆ©
```python
{
    "stock_id": "2330",
    "stock_name": "å°ç©é›»",
    "cost_price": 500,
    "current_price": 560,
    "buy_date": "2025-10-15",
    "holding_days": 47,
    "max_price_since_buy": 630,
    "ma20": 580
}
# è¨ˆç®—ï¼š
# - æœ€é«˜ç²åˆ©ï¼š(630-500)/500 = 26%ï¼ˆ> 10%ï¼Œå•Ÿå‹•ç§»å‹•åœåˆ©ï¼‰
# - å¾é«˜é»å›è½ï¼š(630-560)/630 = 11.1%ï¼ˆ> 10%ï¼‰
# é æœŸçµæœï¼šSELLï¼ˆç§»å‹•åœåˆ©ï¼‰
```

#### Holding D - æŠ€è¡“åœæ
```python
{
    "stock_id": "2454",
    "stock_name": "è¯ç™¼ç§‘",
    "cost_price": 1000,
    "current_price": 970,
    "buy_date": "2025-11-20",
    "holding_days": 11,
    "max_price_since_buy": 1010,
    "ma20": 980
}
# è¨ˆç®—ï¼š
# - æç›Šï¼š-3%ï¼ˆè™§æï¼‰
# - ç¾åƒ¹ < MA20ï¼ˆ970 < 980ï¼‰
# é æœŸçµæœï¼šSELLï¼ˆæŠ€è¡“åœæï¼‰
```

#### Holding E - ç²åˆ©äº†çµ
```python
{
    "stock_id": "3711",
    "stock_name": "æ—¥æœˆå…‰",
    "cost_price": 100,
    "current_price": 135,
    "buy_date": "2025-09-01",
    "holding_days": 91,
    "max_price_since_buy": 138,
    "ma20": 130
}
# è¨ˆç®—ï¼š
# - æç›Šï¼š+35%ï¼ˆ> 30%ï¼‰
# é æœŸçµæœï¼šSELLï¼ˆç²åˆ©äº†çµï¼‰
```

---

## ğŸ“„ è¼¸å‡ºå ±å‘Šæ ¼å¼

### 5.1 å ±å‘Šçµæ§‹

```
ğŸ“Š Manpan æƒ…å ±ç¶² v4.1 - æ¯æ—¥åˆ†æå ±å‘Š
========================================
åŸ·è¡Œæ™‚é–“ï¼š2025-12-01 15:30:00
========================================

ğŸŒ å¸‚å ´ç‹€æ…‹æª¢æŸ¥ (Guardian 1)
----------------------------------------
ç‹€æ…‹ï¼šğŸŸ¢ å®‰å…¨ (SAFE)
æŒ‡æ•¸ï¼šå°ç£åŠ æ¬ŠæŒ‡æ•¸ 17,500 é»
å­£ç·šï¼š17,200 é» (æŒ‡æ•¸é«˜æ–¼å­£ç·š +1.7%)
è·Œåœï¼š35 æ”¯ (< 100 æ”¯é–€æª»)
çµè«–ï¼šâœ… å…è¨±è²·å…¥æ“ä½œ

========================================
ğŸ” å€™é¸è‚¡ç¥¨åˆ†æ (Guardian 2-4-3-6)
----------------------------------------

[1] 2330 å°ç©é›»
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… æµå‹•æ€§ï¼šPASS
   â””â”€ æ—¥å‡æˆäº¤é¡ 145M > 50M
âœ… æŠ€è¡“é¢ï¼šPASS
   â””â”€ ä¹–é›¢ç‡ 5.4% (å¤šé ­æ ¼å±€)
   â””â”€ æ–°èæƒ…ç·’ +0.7 (æ­£é¢)
ğŸ”¥ ç±Œç¢¼é¢ï¼šSTRONG (è©•åˆ† +4)
   â””â”€ å¤–è³‡é€£ 5 æ—¥è²·è¶… (ä½”æ¯” 8%)
   â””â”€ æŠ•ä¿¡é€£ 4 æ—¥è²·è¶… (ä½”æ¯” 3%)
   â””â”€ ä¸‰å¤§æ³•äººåŒæ­¥è²·è¶…
ğŸ’° å»ºè­°å€‰ä½ï¼š15% (é«˜ä¿¡å¿ƒ)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[2] 9999 æ®­å±è‚¡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸš« æµå‹•æ€§ï¼šFAIL
   â””â”€ æ—¥å‡æˆäº¤é¡ 3M < 50M
çµè«–ï¼šæ·˜æ±°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[3] 3324 é›™é´»
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… æµå‹•æ€§ï¼šPASS
ğŸš« æŠ€è¡“é¢ï¼šFAIL (éç†±)
   â””â”€ ä¹–é›¢ç‡ 38.5% > 30%
çµè«–ï¼šæ·˜æ±°ï¼ˆè¿½é«˜é¢¨éšªï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[4] 2603 é•·æ¦®
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… æµå‹•æ€§ï¼šPASS
âœ… æŠ€è¡“é¢ï¼šPASS
ğŸš« ç±Œç¢¼é¢ï¼šAVOID (è©•åˆ† -3)
   â””â”€ å¤–è³‡è³£è¶… -50M (ä½”æ¯” -5%)
   â””â”€ æŠ•ä¿¡è³£è¶… -20M (ä½”æ¯” -2%)
çµè«–ï¼šæ·˜æ±°ï¼ˆæ³•äººæ’¤é€€ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[5] 2454 è¯ç™¼ç§‘
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš ï¸ æµå‹•æ€§ï¼šPASS (çˆ†é‡è­¦ç¤º)
   â””â”€ é‡æ¯” 5.6xï¼ˆç•°å¸¸æ”¾å¤§ï¼‰
çµè«–ï¼šè§€å¯Ÿï¼ˆå¯èƒ½å‡ºè²¨ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

========================================
ğŸ“¦ æŒå€‰å¥æª¢ (Guardian 5)
----------------------------------------

[1] 2317 é´»æµ·
   æˆæœ¬ï¼š100 â†’ ç¾åƒ¹ï¼š115 (+15.0%)
   ç‹€æ…‹ï¼šâœ… HOLD (çºŒæŠ±)

[2] 2603 é•·æ¦®
   æˆæœ¬ï¼š100 â†’ ç¾åƒ¹ï¼š91 (-9.0%)
   ç‹€æ…‹ï¼šâœ‚ï¸ SELL (ç¡¬åœæ -8%)

[3] 2330 å°ç©é›»
   æˆæœ¬ï¼š500 â†’ ç¾åƒ¹ï¼š560 (+12.0%)
   é«˜é»ï¼š630 â†’ å›è½ï¼š11.1%
   ç‹€æ…‹ï¼šğŸ“Š SELL (ç§»å‹•åœåˆ©)

[4] 2454 è¯ç™¼ç§‘
   æˆæœ¬ï¼š1000 â†’ ç¾åƒ¹ï¼š970 (-3.0%)
   æœˆç·šï¼š980 (è·Œç ´ä¸”è™§æ)
   ç‹€æ…‹ï¼šğŸ“‰ SELL (æŠ€è¡“åœæ)

[5] 3711 æ—¥æœˆå…‰
   æˆæœ¬ï¼š100 â†’ ç¾åƒ¹ï¼š135 (+35.0%)
   ç‹€æ…‹ï¼šğŸ¯ SELL (ç²åˆ©äº†çµ +30%)

========================================
ğŸ“Š åŸ·è¡Œæ‘˜è¦
----------------------------------------
âœ… é€šéç¯©é¸ï¼š1 æ”¯ (2330 å°ç©é›»)
ğŸš« æ·˜æ±°ï¼š3 æ”¯ (æµå‹•æ€§ 1ã€éç†± 1ã€ç±Œç¢¼ 1)
âš ï¸ è§€å¯Ÿï¼š1 æ”¯ (2454 è¯ç™¼ç§‘)

ğŸ“¦ æŒå€‰å‹•ä½œï¼š
   - çºŒæŠ±ï¼š1 æ”¯
   - è³£å‡ºï¼š4 æ”¯ (åœæ 2ã€åœåˆ© 2)

å»ºè­°é…ç½®ï¼š
   - 2330 å°ç©é›»ï¼š15%
   - å‰©é¤˜ç¾é‡‘ï¼š85%

========================================
å ±å‘ŠçµæŸ
```

### 5.2 Emoji ä½¿ç”¨è¦ç¯„

| ç¬¦è™Ÿ | ç”¨é€” |
|------|------|
| ğŸŸ¢ | å¸‚å ´å®‰å…¨ / é€šé |
| ğŸ”´ | å¸‚å ´å±éšª / å¤±æ•— |
| âœ… | æª¢æŸ¥é€šé |
| ğŸš« | æª¢æŸ¥å¤±æ•— / æ·˜æ±° |
| âš ï¸ | è­¦ç¤º |
| ğŸ”¥ | å¼·åŠ›è²·å…¥ |
| âš¡ | é©åº¦è²·å…¥ |
| âœ‚ï¸ | åœæè³£å‡º |
| ğŸ“Š | ç§»å‹•åœåˆ© |
| ğŸ“‰ | æŠ€è¡“åœæ |
| ğŸ¯ | ç²åˆ©äº†çµ |
| ğŸ’° | å€‰ä½é…ç½® |
| ğŸš¨ | å¤§ç›¤ç†”æ–· |

---

## ğŸ”§ æŠ€è¡“ç´„æŸ

### 6.1 é–‹ç™¼ç’°å¢ƒ

```python
# Python ç‰ˆæœ¬
Python >= 3.7

# å…è¨±ä½¿ç”¨çš„æ¨™æº–åº«
import random      # ç”¢ç”Ÿ Mock Data
import datetime    # æ—¥æœŸè¨ˆç®—
import json        # (å¯é¸) æ•¸æ“šåºåˆ—åŒ–
```

### 6.2 ç¦æ­¢ä½¿ç”¨

âŒ ä¸å¯ä½¿ç”¨çš„å¥—ä»¶ï¼š
- `requests` (HTTP è«‹æ±‚)
- `yfinance` (è‚¡ç¥¨æ•¸æ“š)
- `twstock` (å°è‚¡æ•¸æ“š)
- `pandas` (æ•¸æ“šåˆ†æ)
- `numpy` (æ•¸å€¼è¨ˆç®—)
- `beautifulsoup4` (ç¶²é çˆ¬èŸ²)

âŒ ä¸å¯é€²è¡Œçš„æ“ä½œï¼š
- å‘¼å«å¤–éƒ¨ API
- è®€å–æœ¬åœ°æª”æ¡ˆï¼ˆé™¤äº†è…³æœ¬è‡ªèº«ï¼‰
- ç¶²è·¯é€£ç·š

### 6.3 åŸ·è¡Œç’°å¢ƒ

âœ… å¿…é ˆå¯åœ¨ä»¥ä¸‹ç’°å¢ƒåŸ·è¡Œï¼š
- Google Colabï¼ˆç·šä¸ŠåŸ·è¡Œï¼‰
- Replitï¼ˆç·šä¸Š IDEï¼‰
- æœ¬åœ° Python ç›´è­¯å™¨

---

## âœ… é–‹ç™¼æª¢æŸ¥æ¸…å–®

### Phase 1: MVP æ ¸å¿ƒåŠŸèƒ½

- [ ] **é…ç½®å€**
  - [ ] å®šç¾©æ‰€æœ‰é–¾å€¼åƒæ•¸ï¼ˆma60ã€turnoverã€bias ç­‰ï¼‰
  - [ ] åƒæ•¸å¯å¿«é€Ÿèª¿æ•´ï¼ˆé›†ä¸­åœ¨ CONFIG å­—å…¸ï¼‰

- [ ] **Mock Data ç”Ÿæˆ**
  - [ ] `generate_market_data()` - å¤šé ­/ç©ºé ­å…©ç¨®å ´æ™¯
  - [ ] `generate_stock_candidates()` - è‡³å°‘ 5 æ”¯æ¸¬è©¦è‚¡ç¥¨
  - [ ] `generate_portfolio()` - è‡³å°‘ 5 ç­†æŒå€‰ï¼ˆæ¶µè“‹æ‰€æœ‰å‡ºå ´æƒ…å¢ƒï¼‰

- [ ] **Guardian 1: å¸‚å ´ç†”æ–·**
  - [ ] æª¢æŸ¥æŒ‡æ•¸ vs MA60
  - [ ] æª¢æŸ¥è·Œåœå®¶æ•¸ > 100
  - [ ] å›å‚³ SAFE / DANGER ç‹€æ…‹

- [ ] **Guardian 2: æµå‹•æ€§**
  - [ ] ä½¿ç”¨æˆäº¤é‡‘é¡ï¼ˆè€Œéæˆäº¤é‡ï¼‰
  - [ ] é–€æª» 50M TWD
  - [ ] çˆ†é‡åµæ¸¬ï¼ˆé‡æ¯” > 5xï¼‰

- [ ] **Guardian 3: ç±Œç¢¼**
  - [ ] æª¢æŸ¥å¤–è³‡é€£çºŒè²·è¶… + ä½”æ¯”
  - [ ] æª¢æŸ¥æŠ•ä¿¡é€£çºŒè²·è¶… + ä½”æ¯”
  - [ ] æª¢æŸ¥ä¸‰å¤§æ³•äººåŒæ­¥
  - [ ] è¨ˆç®—è©•åˆ†ï¼ˆ-3 åˆ° +3ï¼‰

- [ ] **Guardian 4: æŠ€è¡“**
  - [ ] è¨ˆç®—ä¹–é›¢ç‡ï¼ˆvs MA60ï¼‰
  - [ ] å€åˆ†å¤šé ­/ç©ºé ­é–€æª»ï¼ˆ30% vs 15%ï¼‰
  - [ ] æª¢æŸ¥ Mock æ–°èåˆ†æ•¸

- [ ] **Guardian 5: å‡ºå ´**
  - [ ] å¤§ç›¤ç†”æ–·å„ªå…ˆ
  - [ ] ç¡¬åœæï¼ˆæŒæœ‰ â‰¥ 3 å¤©ï¼Œ-8%ï¼‰
  - [ ] æŠ€è¡“åœæï¼ˆç ´ MA20 ä¸”è™§æï¼‰
  - [ ] ç§»å‹•åœåˆ©ï¼ˆç²åˆ© > 10% å¾Œï¼Œå›è½ > 10%ï¼‰
  - [ ] ç²åˆ©äº†çµï¼ˆ+30%ï¼‰

- [ ] **Guardian 6: å€‰ä½**
  - [ ] è©•åˆ† â‰¥ 3 â†’ 15%
  - [ ] è©•åˆ† > 0 â†’ 8%
  - [ ] è©•åˆ† â‰¤ 0 â†’ 0%

- [ ] **ä¸»æµç¨‹**
  - [ ] å…ˆåŸ·è¡Œ Guardian 1ï¼ˆå¸‚å ´æª¢æŸ¥ï¼‰
  - [ ] å¦‚æœ DANGER â†’ åœæ­¢è²·å…¥ï¼Œåƒ…åŸ·è¡Œ Guardian 5
  - [ ] å¦‚æœ SAFE â†’ åŸ·è¡Œ Guardian 2-4-3-6
  - [ ] è¼¸å‡ºåˆ†æå ±å‘Š

- [ ] **è¼¸å‡ºå ±å‘Š**
  - [ ] å¸‚å ´ç‹€æ…‹å€å¡Š
  - [ ] å€™é¸è‚¡ç¥¨åˆ†æï¼ˆé€ä¸€å±•ç¤ºéæ¿¾éç¨‹ï¼‰
  - [ ] æŒå€‰å¥æª¢ï¼ˆåŸ·è¡Œ Guardian 5ï¼‰
  - [ ] åŸ·è¡Œæ‘˜è¦ï¼ˆçµ±è¨ˆé€šé/æ·˜æ±°æ•¸é‡ï¼‰
  - [ ] ä½¿ç”¨ emoji æ¨™ç¤º

- [ ] **æ¸¬è©¦é©—è­‰**
  - [ ] å¤šé ­å¸‚å ´å ´æ™¯ï¼ˆSAFEï¼‰
  - [ ] ç©ºé ­å¸‚å ´å ´æ™¯ï¼ˆDANGERï¼‰
  - [ ] æ‰€æœ‰è‚¡ç¥¨æ¸¬è©¦æ¡ˆä¾‹æ­£ç¢º
  - [ ] æ‰€æœ‰æŒå€‰æ¸¬è©¦æ¡ˆä¾‹æ­£ç¢º

---

### Phase 2: æ–°èæƒ…ç·’ AIï¼ˆæœªä¾†æ“´å±•ï¼‰

- [ ] ä¸²æ¥ Gemini API
- [ ] çˆ¬å–å³æ™‚æ–°è
- [ ] æƒ…ç·’åˆ†é¡ï¼ˆæ­£é¢/è² é¢/ä¸­æ€§ï¼‰
- [ ] æ•´åˆåˆ° Guardian 4

---

### Phase 3: å›æ¸¬å¼•æ“ï¼ˆæœªä¾†æ“´å±•ï¼‰

- [ ] è¼‰å…¥æ­·å²æ•¸æ“š
- [ ] æ¨¡æ“¬äº¤æ˜“åŸ·è¡Œ
- [ ] è¨ˆç®—å‹ç‡ã€å¤æ™®ã€MDD
- [ ] ç”¢å‡ºç¸¾æ•ˆå ±å‘Š

---

## ğŸ“Š é™„éŒ„ï¼šå®Œæ•´åƒæ•¸è¡¨

| å®ˆè­·è€… | åƒæ•¸åç¨± | å€¼ | å–®ä½ |
|--------|---------|---|------|
| **Guardian 1** | `ma60_period` | 60 | äº¤æ˜“æ—¥ |
| | `limit_down_threshold` | 100 | æ”¯ |
| | `limit_down_ratio` | 9.5 | % |
| **Guardian 2** | `min_turnover` | 50,000,000 | TWD |
| | `volume_spike_ratio` | 5 | å€ |
| **Guardian 3** | `foreign_consecutive_days` | 3 | æ—¥ |
| | `foreign_buy_ratio` | 0.05 | 5% |
| | `trust_consecutive_days` | 3 | æ—¥ |
| | `trust_buy_ratio` | 0.03 | 3% |
| **Guardian 4** | `bias_base` | MA60 | - |
| | `bias_threshold_bull` | 0.30 | 30% |
| | `bias_threshold_bear` | 0.15 | 15% |
| | `news_negative_threshold` | -0.3 | - |
| **Guardian 5** | `stop_loss` | -0.08 | -8% |
| | `holding_days_min` | 3 | æ—¥ |
| | `trailing_profit_trigger` | 0.10 | 10% |
| | `trailing_stop_ratio` | 0.10 | 10% |
| | `take_profit` | 0.30 | 30% |
| **Guardian 6** | `high_confidence_allocation` | 0.15 | 15% |
| | `medium_confidence_allocation` | 0.08 | 8% |
| | `high_confidence_score` | 3 | åˆ† |

---

## ğŸ“ ç¨‹å¼ç¢¼æ¶æ§‹ç¯„ä¾‹

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Manpan æƒ…å ±ç¶² v4.1 - æœ€çµ‚å®šæ¡ˆç‰ˆ
æ•´åˆ FEEDBACK1 + FEEDBACK2 + å°ˆæ¥­å¯©æŸ¥å»ºè­°
"""

import random
from datetime import datetime, timedelta

# ============================================================
# é…ç½®å€ï¼ˆæ‰€æœ‰é–¾å€¼é›†ä¸­ç®¡ç†ï¼‰
# ============================================================
CONFIG = {
    # Guardian 1
    "ma60_period": 60,
    "limit_down_threshold": 100,

    # Guardian 2
    "min_turnover": 50_000_000,
    "volume_spike_ratio": 5,

    # Guardian 3
    "foreign_consecutive_days": 3,
    "foreign_buy_ratio": 0.05,
    "trust_consecutive_days": 3,
    "trust_buy_ratio": 0.03,

    # Guardian 4
    "bias_threshold_bull": 0.30,
    "bias_threshold_bear": 0.15,
    "news_negative_threshold": -0.3,

    # Guardian 5
    "stop_loss": -0.08,
    "holding_days_min": 3,
    "trailing_profit_trigger": 0.10,
    "trailing_stop_ratio": 0.10,
    "take_profit": 0.30,

    # Guardian 6
    "high_confidence_allocation": 0.15,
    "medium_confidence_allocation": 0.08,
    "high_confidence_score": 3,
}

# ============================================================
# Mock Data ç”Ÿæˆ
# ============================================================

def generate_market_data(scenario="bull"):
    """ç”Ÿæˆå¸‚å ´æ•¸æ“š"""
    # ... å¯¦ä½œ

def generate_stock_candidates():
    """ç”Ÿæˆ 5 æ”¯æ¸¬è©¦è‚¡ç¥¨"""
    # ... å¯¦ä½œ

def generate_portfolio():
    """ç”Ÿæˆ 5 ç­†æŒå€‰"""
    # ... å¯¦ä½œ

# ============================================================
# å…­å¤§å®ˆè­·è€…
# ============================================================

def guardian_1_market_check(market_data):
    """å¸‚å ´ç†”æ–·æª¢æŸ¥"""
    # ... å¯¦ä½œ

def guardian_2_liquidity_check(stock):
    """æµå‹•æ€§æª¢æŸ¥"""
    # ... å¯¦ä½œ

def guardian_3_chips_consensus(stock):
    """ç±Œç¢¼å…±è­˜è©•åˆ†"""
    # ... å¯¦ä½œ

def guardian_4_technical_check(stock):
    """æŠ€è¡“ + æ–°èæª¢æŸ¥"""
    # ... å¯¦ä½œ

def guardian_5_exit_strategy(position, market_status):
    """å‡ºå ´ç­–ç•¥"""
    # ... å¯¦ä½œ

def guardian_6_position_sizing(chips_score):
    """å€‰ä½é…ç½®"""
    # ... å¯¦ä½œ

# ============================================================
# ä¸»æµç¨‹
# ============================================================

def analyze_watchlist(stocks, market_data):
    """åˆ†æå€™é¸è‚¡ç¥¨"""
    # ... å¯¦ä½œ

def check_portfolio(holdings, market_status):
    """æª¢æŸ¥æŒå€‰"""
    # ... å¯¦ä½œ

def print_report(...):
    """è¼¸å‡ºå ±å‘Š"""
    # ... å¯¦ä½œ

def main():
    """ä¸»ç¨‹å¼"""
    print("ğŸ“Š Manpan æƒ…å ±ç¶² v4.1 - æ¯æ—¥åˆ†æå ±å‘Š")
    print("=" * 50)

    # 1. ç”Ÿæˆ Mock Data
    market = generate_market_data("bull")
    stocks = generate_stock_candidates()
    portfolio = generate_portfolio()

    # 2. Guardian 1: å¸‚å ´æª¢æŸ¥
    market_status = guardian_1_market_check(market)

    # 3. åˆ†æå€™é¸è‚¡ç¥¨
    if market_status['status'] == 'SAFE':
        results = analyze_watchlist(stocks, market)

    # 4. æŒå€‰å¥æª¢
    exit_actions = check_portfolio(portfolio, market_status['status'])

    # 5. è¼¸å‡ºå ±å‘Š
    print_report(market_status, results, exit_actions)

if __name__ == "__main__":
    main()
```

---

## ğŸ¯ æœ€çµ‚ç¢ºèª

### æ­¤è¦æ ¼æ›¸å·²è§£æ±ºçš„å•é¡Œ

âœ… **æ‰€æœ‰åƒæ•¸å®šç¾©æ˜ç¢º**
- Guardian 1-6 çš„æ¯å€‹åƒæ•¸éƒ½æœ‰å…·é«”æ•¸å€¼
- Mock Data çš„ä¾†æºèˆ‡æ ¼å¼å®Œæ•´å®šç¾©
- ä¸å†æœ‰ã€Œä¾†æºä¸æ˜ã€çš„è®Šæ•¸

âœ… **é‚è¼¯æµç¨‹å®Œæ•´**
- å…­å¤§å®ˆè­·è€…çš„åŸ·è¡Œé †åºæ¸…æ¥š
- å„ªå…ˆç´šæ˜ç¢ºï¼ˆå¤§ç›¤ç†”æ–· > å€‹è‚¡ç¯©é¸ > å€‰ä½é…ç½® > å‡ºå ´ï¼‰

âœ… **æ¸¬è©¦æ¡ˆä¾‹é½Šå…¨**
- 5 æ”¯å€™é¸è‚¡ç¥¨æ¶µè“‹æ‰€æœ‰æƒ…å¢ƒ
- 5 ç­†æŒå€‰æ¶µè“‹æ‰€æœ‰å‡ºå ´æƒ…å¢ƒ
- å¯é©—è­‰æ¯å€‹ Guardian çš„æ­£ç¢ºæ€§

âœ… **è¼¸å‡ºæ ¼å¼å°ˆæ¥­**
- ä½¿ç”¨ emoji æå‡å¯è®€æ€§
- çµæ§‹åŒ–å ±å‘Šï¼ˆå¸‚å ´ â†’ å€™é¸ â†’ æŒå€‰ â†’ æ‘˜è¦ï¼‰
- ç¬¦åˆæ©Ÿæ§‹æŠ•è³‡äººå¯©æŸ¥æ¨™æº–

---

## ğŸ“Œ ä¸‹ä¸€æ­¥è¡Œå‹•

1. **ç¢ºèªç†è§£**
   - è«‹ç¢ºèªæ­¤è¦æ ¼æ›¸ç¬¦åˆæ‚¨çš„éœ€æ±‚
   - æœ‰ä»»ä½•ç–‘å•è«‹ç«‹å³æå‡º

2. **æº–å‚™å¯¦ä½œ**
   - æ™šé»é–‹å§‹æ’°å¯« `manpan_v4_1.py`
   - é è¨ˆé–‹ç™¼æ™‚é–“ï¼š2.5-3 å°æ™‚

3. **éƒ¨ç½²è¨ˆç•«**
   - å› æœ¬åœ°ç„¡æ³•è£ Pythonï¼Œå»ºè­°ä½¿ç”¨ï¼š
     - **Google Colab**ï¼ˆæ¨è–¦ï¼Œå…è²»ç·šä¸ŠåŸ·è¡Œï¼‰
     - **Replit**ï¼ˆç·šä¸Š IDEï¼Œå¯åˆ†äº«ï¼‰
     - **PythonAnywhere**ï¼ˆå¯æ¶è¨­ç‚º Web æœå‹™ï¼‰

---

**è¦æ ¼æ›¸åˆ¶å®šå®Œæˆï¼Œç­‰å¾…æ‚¨çš„ç¢ºèªï¼** ğŸš€

_æ–‡ä»¶ç‰ˆæœ¬ï¼šv1.0 Final_
_æœ€å¾Œæ›´æ–°ï¼š2025-12-01_
