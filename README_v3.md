# 選股 BOT v3.4 使用說明

## 功能

找「法人有在買、趨勢向上、還沒過熱」的股票（狼性操盤手版）

## 篩選條件

**基本面**
- 價格 30-300 元
- PE < 35
- 營收 YoY > 0%

**技術面**
- 今日漲幅 -2% ~ 5% (v3.3: 容許小回檔)
- 近 5 日累積漲幅 < 10%
- 今日量 > 5 日均量
- 股價 > MA
- **RSI < 80 (v3.3 新增: 避免過熱)**

**籌碼面**
- 法人連續買超 >= 2 天 (v3.3: 移除上限)
- 法人 5 日累積 > 300 張
- 日成交量 > 800 張
- 法人 1 月累積 > -10,000 張
- 主力分析 (投信/外資/混合)

## 使用方式

```bash
cd STOCK_HUNTER
python scan_v3.py
```

執行後會產生 `scan_result_v3.txt`，包含健康檢查報告和推薦股票。

## ⚠️ 防呆機制 (v3.2 新增)

### 健康檢查報告

輸出檔案會包含資料健康狀態：

```
[健康檢查]
✅ 資料正常
  證交所: 91 檔
  PE: 807 檔
  法人: 30/30 成功
  營收: 28/30 成功
```

### API 異常警告

當 API 有問題時會顯示警告：

| 異常類型 | 警告訊息 |
|---------|---------|
| API 完全失敗 | `API錯誤: xxx` |
| 達到 FinMind 上限 | `法人資料大量失敗 (xx%)，FinMind 可能達上限` |
| 資料被截斷 | `證交所 API 無資料（可能被擋或假日）` |
| 成功率過低 | `法人資料成功率過低 (xx%)` |

### LINE 訊息範例（有異常時）

```
📊 選股 BOT v3.2 - 2026-01-01

⚠️ 資料警告: 法人資料大量失敗 (45%)，FinMind 可能達上限

❌ 今日無符合條件的股票
```

## 環境設定

### FinMind API Token

程式已內建 Token（600 次/小時），也可透過環境變數覆蓋：

```bash
export FINMIND_TOKEN="your_token_here"
```

---

## 🏗️ 系統架構 (2026-01-01 更新)

```
每天 20:30 (週一~週五)
┌──────────────────┐
│  GitHub Actions  │  ← 跑 scan_v3.py
└────────┬─────────┘
         ↓ push_to_linebot.py
┌──────────────────┐
│  Zeabur (精簡版)  │  ← 只當轉發站，不做運算
└────────┬─────────┘
         ↓ LINE Messaging API
┌──────────────────┐
│   LINE 通知你    │
└──────────────────┘
```

### 各元件職責

| 元件 | 檔案 | 職責 |
|------|------|------|
| **GitHub Actions** | `scan_v3.py` | 每日 20:30 掃描選股 |
| **Zeabur** | `line_relay.py` (精簡版) | 接收推送 → 轉發 LINE |
| **本地** | 問 Claude | 隨時分析單股 |

### 為什麼這樣設計？

1. **GitHub Actions 免費** — 不用擔心運算額度
2. **Zeabur 精簡** — 只保留 Flask + LINE SDK，映像變小
3. **不需要即時互動** — 每日推送夠用，急需分析問 Claude

## 📡 API 使用狀態

### 目前使用

| API | 用途 | 限制 | 狀態 |
|-----|------|------|------|
| **證交所 OpenAPI** | 當日股價、PE | 免費無限制 | ✅ 穩定 |
| **FinMind 免費會員** | 法人、歷史股價、營收 | 600 次/小時 | ⚠️ 觀察中 |

### 後續考慮方案

| 方案 | 優點 | 缺點 | 備註 |
|------|------|------|------|
| **Shioaji** (永豐金證券) | 免費、即時報價 | 需開戶 | Python API |
| **FinMind 付費版** | 穩定、資料完整 | $1499/月 | 目前觀察免費版穩定度 |
| **Fugle 富果** | 即時行情 | 需註冊、限制較多 | 備選 |

### 穩定度觀察紀錄

| 日期 | 狀況 | 結論 |
|------|------|------|
| 2026-01-01 | 免費會員 600 次/小時，測試正常 | ✅ |
| 2025-12-31 | 疑似 API 塞車（實為買超天數邏輯問題） | ✅ 非 API 問題 |

---

## 版本紀錄

### v3.4 (2026-01-01)
- **新增**: 劇本小卡功能 - 每檔推薦股票附帶停損/停利價格
- **新增**: 動態停損邏輯 (乖離>5%守MA10，乖離<5%守MA20，底線-7%)
- **新增**: 停利目標 +20%
- **新增**: LINE 訊息改用卡片式格式

### v3.3 (2026-01-01)
- **新增**: RSI < 80 過熱判斷（避免追在最高點）
- **放寬**: 漲跌幅 -2% ~ 5%（原 0-5%，容許小回檔）
- **放寬**: 法人連續買超 >= 2 天（移除上限 7 天）
- **修正**: 編創 (3231) 回歸名單（原被 8 天上限刷掉）

### v3.2 (2026-01-01)
- **新增**: FinMind API Token 支援（600 次/小時）
- **新增**: 健康檢查報告（證交所/PE/法人/營收 成功率）
- **新增**: API 錯誤偵測與警告（達上限、被擋、無資料）
- **新增**: LINE 訊息顯示資料警告
- **新增**: 股價 > MA20 趨勢確認
- **新增**: 法人 5 日累積 > 300 張
- **新增**: 日成交量 > 800 張
- **放寬**: 價格 30-300 元（原 50-200）
- **放寬**: PE < 35（原 < 25）
- **放寬**: 營收 YoY > 0%（原 > 10%）
- **放寬**: 法人買超 2-7 天（原 3-5 天）

### v3.1 (2025-12-31)
- 新增: 營收 YoY > 10% 檢查
- 新增: 法人 1 月累積 > -10,000 張檢查
- 新增: 主力分析功能
- 移除: 寬鬆版輸出
- 暫停: 財報檢查

### v3.0 (2025-12-31)
- 新增：近 5 日漲幅檢查
- 新增：法人買超天數檢查
- 新增：成交量突破檢查

