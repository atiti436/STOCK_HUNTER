# 選股 BOT v3.1 使用說明

## 功能

找「法人剛進場、體質健康、還沒噴、營收成長」的股票（抓起漲點，不追高）

## 篩選條件

**基本面**
- 價格 50-200 元
- PE < 25
- ~~毛利率 > 20%~~ (暫時停用 - API 問題)
- ~~營業利益率 > 0%~~ (暫時停用 - API 問題)
- **營收 YoY > 10%** ✅ (v3.1 新增)

**技術面**
- 今日漲幅 0-5%
- 近 5 日累積漲幅 < 10% (避免追高)
- 今日量 > 5 日均量 (啟動訊號)

**籌碼面**
- 法人買超 3-5 天 (剛進場)
- **法人 1 月累積 > -10,000 張** ✅ (v3.1 新增 - 避免長期賣壓)
- **主力分析 (投信/外資/混合)** ✅ (v3.1 新增 - 參考用)

**輸出說明**
- 只輸出符合**所有條件**的股票（嚴格篩選）
- 不符合任一條件的股票會被直接排除

## 使用方式

```bash
cd STOCK_HUNTER
python scan_v3.py
```

執行後會產生 `scan_result_v3.txt`，只包含符合所有條件的推薦股票。

## 輸出範例

```
[OK] 符合條件 (推薦買入)
#  代號   名稱      價格   漲幅    PE  法人5日   法人1月  主力   營收YoY  買天  5日漲  量/均
1  3231  緯創     151.0  +0.7%  19.0  +18,478  +25,000  投信   +194.6%   4    +3.2%  8000/6500
```

## ✅ 已解決問題 (2025-12-31 完成)

### 問題 1: FinMind 法人 API 無法抓全部股票 ✅

**原因**: `stock_id=''` (空字串抓全部)在法人資料不支援

**解決**: 改成逐檔抓取 (第 92-193 行)
- 先用 PE < 25 篩選 (61 → 30 檔)
- 迴圈逐檔呼叫 `stock_id='2330'`
- 成功率: 30/30 檔 (100%)

---

### 問題 2: 證交所 API 被擋 ✅

**原因**: 12/31 年底流量大

**解決**: 改用 FinMind 抓歷史股價 (第 42-89 行)
- `dl.taiwan_stock_daily()` 穩定快速
- 成功率: 50/50 檔 (100%)

---

### 問題 3: 財報檢查暫時跳過

**現況**: 第 388 行註解掉 `financial_data = {}`

**原因**: FinMind 財報 API 格式待確認

**TODO**:
- [ ] 啟用財報檢查
- [ ] 驗證華新科會被排除到寬鬆版(毛利率 16.99%)

---

## 執行結果 (2025-12-31 測試)

### 成功執行
```
基本篩選: 61 檔
PE < 25: 30 檔
法人資料: 30/30 成功
歷史股價: 50/50 成功
總耗時: ~30 秒
```

### 輸出結果
- **嚴格版**: 2 檔 (3231 緯創, 3706 神達)
- **寬鬆版**: 13 檔
  - 2603 長榮 → 量能不足 ✅
  - 2492 華新科 → 法人買1天 + 量能不足 ✅
  - 1513 中興電 → 量能不足

---

## 待辦事項

### 次要優化
- [ ] 啟用財報檢查 (毛利率、營業利益率)
- [ ] 加快執行速度 (目前 30 秒)
- [ ] 加入更多技術指標

### 完整測試 (正常交易日)
- [x] 驗證法人逐檔抓取
- [x] 驗證歷史股價 FinMind
- [x] 驗證長榮會出現在寬鬆版
- [x] 確認輸出格式正確
- [ ] 在非年底測試財報檢查

## 版本紀錄

### v3.1 (2025-12-31)
- **新增**: 營收 YoY > 10% 檢查（確保成長動能）
- **新增**: 法人 1 月累積 > -10,000 張檢查（避免長期賣壓）
- **新增**: 主力分析功能（投信/外資/混合）
- **移除**: 寬鬆版輸出（只保留嚴格版）
- **移除**: volume > 500 張硬門檻（改用「今日量 > 5日均量」）
- **修正**: 5 日資料不足時正確處理（回傳 None 而非 0）
- **修正**: 資料一致性問題（所有步驟使用相同股票清單）
- **暫停**: 財報檢查（毛利率/營業利益率 - FinMind API 問題）

### v3.0 (2025-12-31)
- 新增：近 5 日漲幅檢查(避免追高)
- 新增：法人買超天數檢查(抓起漲點)
- 新增：成交量突破檢查
- 新增：雙清單輸出(嚴格版/寬鬆版)
- 待修：財報檢查(FinMind API 問題)
