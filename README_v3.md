# 選股 BOT v3.0 使用說明

## 功能

找「法人剛進場、體質健康、還沒噴」的股票（抓起漲點，不追高）

## 篩選條件

### 嚴格版（推薦買）

**基本面**
- 價格 50-200 元
- PE < 25
- 毛利率 > 20% (TODO: 財報 API 待修正)
- 營業利益率 > 0% (TODO: 財報 API 待修正)

**技術面 & 籌碼面**
- 今日漲幅 0-5%
- 近 5 日累積漲幅 < 10% (避免追高)
- 法人買超 3-5 天 (剛進場，不是已經買很久)
- 今日量 > 5 日均量 (啟動訊號)

### 寬鬆版（觀察用）

不符合上述某些條件，但會標註原因(如「5日漲12%」、「法人買10天」、「毛利率16%」)

## 使用方式

```bash
cd STOCK_HUNTER
python scan_v3.py
```

執行後會產生 `scan_result_v3.txt`，包含兩份清單：
- [OK] 嚴格版：可直接買
- [!] 寬鬆版：需討論

## 輸出範例

```
[OK] 嚴格版（推薦買）
#  代號   名稱      價格   漲幅    PE  毛利率  營利率  法人      買天  5日漲  量/均
1  1513  中興電   151.0  +2.3%  18.5  25.0%   13.0%   +5,000     4   +3.2%  8000/6500

[!] 寬鬆版（觀察用）
#  代號   名稱      價格   漲幅    PE  法人(張)  疑慮
1  2492  華新科   115.5  +1.2%  23.9   +3,000    5日漲12%, 毛利率16.9%
```

## ✅ 已解決問題 (2025-12-31 完成)

### 問題 1: FinMind 法人 API 無法抓全部股票 ✅

**原因**: `stock_id=''` (空字串抓全部)在法人資料不支援

**解決**: 改成逐檔抓取 (第 92-193 行)
- 先用 PE < 25 篩選 (61 → 30 檔)
- 迴圈逐檔呼叫 `stock_id='2330'`
- 成功率: 30/30 檔 (100%)

---

### 問題 2: 證交所 API 被擋 ✅

**原因**: 12/31 年底流量大

**解決**: 改用 FinMind 抓歷史股價 (第 42-89 行)
- `dl.taiwan_stock_daily()` 穩定快速
- 成功率: 50/50 檔 (100%)

---

### 問題 3: 財報檢查暫時跳過

**現況**: 第 388 行註解掉 `financial_data = {}`

**原因**: FinMind 財報 API 格式待確認

**TODO**:
- [ ] 啟用財報檢查
- [ ] 驗證華新科會被排除到寬鬆版(毛利率 16.99%)

---

## 執行結果 (2025-12-31 測試)

### 成功執行
```
基本篩選: 61 檔
PE < 25: 30 檔
法人資料: 30/30 成功
歷史股價: 50/50 成功
總耗時: ~30 秒
```

### 輸出結果
- **嚴格版**: 2 檔 (3231 緯創, 3706 神達)
- **寬鬆版**: 13 檔
  - 2603 長榮 → 量能不足 ✅
  - 2492 華新科 → 法人買1天 + 量能不足 ✅
  - 1513 中興電 → 量能不足

---

## 待辦事項

### 次要優化
- [ ] 啟用財報檢查 (毛利率、營業利益率)
- [ ] 加快執行速度 (目前 30 秒)
- [ ] 加入更多技術指標

### 完整測試 (正常交易日)
- [x] 驗證法人逐檔抓取
- [x] 驗證歷史股價 FinMind
- [x] 驗證長榮會出現在寬鬆版
- [x] 確認輸出格式正確
- [ ] 在非年底測試財報檢查

## 版本紀錄

### v3.0 (2025-12-31)
- 新增：近 5 日漲幅檢查(避免追高)
- 新增：法人買超天數檢查(抓起漲點)
- 新增：成交量突破檢查
- 新增：雙清單輸出(嚴格版/寬鬆版)
- 待修：財報檢查(FinMind API 問題)
